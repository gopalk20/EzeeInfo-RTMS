# Pre-Implementation Checklist: RTMS Baseline

**Purpose**: Validate requirements completeness, constitution alignment, and implementation readiness before Phase 0; re-run before Phases 11–12  
**Created**: 2026-02-19  
**Feature**: [.specify/memory/spec.md](.specify/memory/spec.md) | **Plan**: [.specify/memory/plan.md](.specify/memory/plan.md) | **Constitution**: v1.9.1

**Note**: Generated by `/speckit.checklist` from spec, plan, constitution, and clarify (all resolved).

---

## 1. Constitution Compliance

- [ ] CHK001 All eight principles (I–VIII) verified for alignment with implementation approach
- [ ] CHK002 BR-1 (daily hours limit) configurable via database or .env—no hard-coding
- [ ] CHK003 BR-2 (D+N policy) configurable—config keys for D and N
- [ ] CHK004 BR-3 (final approval locks entries) enforced at application and DB level
- [ ] CHK005 BR-4 (Rework %) calculated from formula—no manual override
- [ ] CHK006 BR-5 (Hourly Cost) calculated from formula—no manual override
- [ ] CHK007 Tech stack restricted to PHP 8.4, CodeIgniter 4, Smarty 5, MySQL—no additional frameworks
- [ ] CHK008 Audit trail planned for editable records (user, timestamp, before/after)

---

## 2. Requirements Completeness

- [ ] CHK009 All 5 roles (Employee, Product Lead, Manager, Finance, Super Admin) have defined Can Do / Cannot Do
- [ ] CHK010 Product Lead approves timesheets only (for product members); Manager approves task completion and timesheets for direct reports (FR-021, Q8.3)
- [ ] CHK011 Product Lead and Finance cannot see financial costing (FR-005)
- [ ] CHK012 GitHub sync scope: Issues + PRs (clarify Q1.5)
- [ ] CHK013 Branch linking: Employee selects from GitHub list; one branch per task (FR-011, Q1.4)
- [ ] CHK014 Status transitions: Webhooks for first commit → In Progress, merge → Completed (FR-013, FR-014)
- [ ] CHK015 D+N policy edit guard implemented (FR-017)
- [ ] CHK016 Rework: Employee marks is_rework when logging (FR-019)
- [ ] CHK017 Timeline exceeded: Show warning; allow logging (FR-020a, Q6.2)
- [ ] CHK018 Employee removed: Reassign tasks to Product Lead (Q6.3)
- [ ] CHK019 Max time exceeded: Warn only; do not block (Q2.1)

---

## 3. Phase 0 Readiness

- [ ] CHK020 PHP 8.4, CodeIgniter 4, MySQL 8.x verified
- [ ] CHK021 Extensions: pdo_mysql, curl, json, mbstring available
- [ ] CHK022 Existing users table can be extended with role_id
- [ ] CHK023 roles table migration designed (Employee, Product Lead, Manager, Finance)
- [ ] CHK024 config table migration designed (daily_hours_limit, D, N, working_days, standard_hours)
- [ ] CHK025 RoleFilter design documented; route-role mapping defined
- [ ] CHK026 Auth: session-based, CSRF, bcrypt/argon2 (existing or to implement)

---

## 4. Phase 1–6 Prerequisites

- [x] CHK027 Products schema: name, start_date, end_date, max_allowed_hours, github_repo_url
- [x] CHK028 product_members join table designed
- [ ] CHK029 GitHub PAT or App token strategy defined (storage, rotation)
- [ ] CHK030 Webhook endpoint URL strategy (public URL or ngrok for dev)
- [x] CHK031 time_entries schema includes is_rework flag
- [ ] CHK032 approvals table designed (task_id, approver_id, approved_at, status)
- [ ] CHK033 Export libraries for CSV, PDF, Excel identified

---

## 5. Security & RBAC

- [ ] CHK034 Every controller action has role check before business logic
- [ ] CHK035 No client-side-only enforcement of permissions
- [ ] CHK036 Manager-only routes: approve, user/role management, costing
- [ ] CHK037 Product Lead blocked from costing routes only; can approve timesheets for product members
- [ ] CHK038 Employee blocked from create product/task, assign, approve
- [ ] CHK039 Finance blocked from create/modify products/tasks, approve
- [ ] CHK039a Super Admin only can edit user cost (resource_costs); Manager view-only (FR-005c, Q11.3)

---

## 6. Data Integrity & Edge Cases

- [ ] CHK040 Locked entries (approved) cannot be modified—guard in controller/model
- [ ] CHK041 Branch already linked: Reject link if branch used by another task
- [ ] CHK042 GitHub sync failure: Disable sync, log error, surface to admin
- [ ] CHK043 Rejection flow: Return to previous state; log feedback (Constitution V)

---

## 7. Testing & Traceability

- [ ] CHK044 Critical paths identified for automated tests: timesheet validation, approval, costing
- [ ] CHK045 Migration rollback path documented
- [ ] CHK046 Feature work traceable to FR IDs in spec

---

## 8. User Story Acceptance

- [ ] CHK047 US1: Product Lead creates product, adds members, links repo—acceptance scenarios testable
- [ ] CHK048 US2: Employee links branch, logs time, completes task—status reflects Git activity
- [ ] CHK049 US3: Manager approves—task locked; Product Lead/Employee cannot approve
- [ ] CHK050 US4: Finance views reports; export CSV/PDF/Excel
- [ ] CHK051 US5: Employee logs rework time; Rework % calculated correctly

---

## 9. Success Criteria Alignment

- [ ] CHK052 SC-001: Product Lead create product + add members + link repo in &lt;5 min
- [ ] CHK053 SC-002: Employee task flow with Git-backed status transitions
- [ ] CHK054 SC-003: Finance generates task-wise and employee-wise reports
- [ ] CHK055 SC-004: 100% RBAC enforcement (no role bypass)
- [ ] CHK056 SC-005: BR-3 enforced—completed/approved timing immutable
- [ ] CHK057 SC-006: Rework % correct per BR-4

---

## 10. Phase 11–12 (Security, Session, URL, Cost, Email) Prerequisites

- [ ] CHK058 Session: 24h idle (86400s config); any page load refreshes (FR-000a1, Q11.1)
- [ ] CHK059 URL: History API replaceState; address bar shows domain only (FR-000a2, Q11.2)
- [ ] CHK060 Super Admin: user cost (salary) edit only; Manager per-day view (FR-005c, Q11.3)
- [ ] CHK061 Cloud security: HTTPS, secure cookies, rate limiting, XSS/SQLi prevention, security headers (FR-032, FR-033)
- [ ] CHK062 Security documentation: encryption, access controls, audit, vulnerability reporting (FR-034)
- [ ] CHK063 Email: .env for SMTP credentials; Admin UI for from/reply-to (FR-035, Q10.1)
- [ ] CHK064 Employee reminder: weekly (Mon–Fri; missed = any work day fewer than 8h); monthly (last day of month) (FR-036, Q10.2, Q10.3)
- [ ] CHK065 Approver reminder: consolidated (one email per approver); weekly/monthly (FR-037, Q10.4)
- [ ] CHK066 CLI command + cron for automatic reminders (FR-035–037, Q10.5)
- [ ] CHK067 Email templates: 4 types; placeholders; Super Admin UI (FR-038, Q10.6)

---

## Notes

- Mark items complete with `[x]`
- Add comments or findings inline as needed
- Link to spec FR, plan phase, or constitution section
- Run this checklist before starting Phase 0; re-run before each phase gate

---

---

## Implementation Progress (2026-02-19)

| Item | Status |
|------|--------|
| Products, tasks, time_entries migrations | Done |
| users.reporting_manager_id, is_active; time_entries.status | Done |
| ProductModel, TaskModel, TimeEntryModel | Done |
| ApprovalModel, ResourceCostModel, MilestoneModel | Done |
| Timesheet workflow (status, edit before approval) | Done |
| Reporting structure (reporting_manager_id) | Done |
| Product Lead + Manager timesheet approvals | Done |
| Team timesheet (consolidated view) | Done |
| Super Admin product CRUD, access control | Done |
| Manager/Super Admin task CRUD | Done |
| User enable/disable, modify reporting manager | Done |
| Vertex UI (login, layout, dashboard) | Done |
| Time Sheet grid (/timesheet/sheet) | Done |
| Team Timesheet resource allocation format | Done |
| Reports date range filter | Done |
| Manage Users redesign (table, Edit page, team filter) | Done |
| Product Disable/Enable (products.is_disabled) | Done |
| Timesheet success message, redirect to summary | Done |
| Team Timesheet member details view | Done |
| Approval POST method fix (getMethod returns 'POST') | Done |
| Timesheet reject (rejectTimesheet, rejectEntry) | Done |
| Approval page: icon buttons (✓ approve, ✗ reject) | Done |
| Approval page: Approved Task Completions + Approved Timesheet Entries sections | Done |
| Leave products (Holiday, Sick Leave, Planned Leave, Training) | Done |
| products.product_type; LeaveProductsSeeder | Done |
| TaskModel getByAssignee includes leave for all users | Done |
| TimesheetController::log allows leave tasks (assignee_id=null) | Done |
| Admin Dashboard (/admin/dashboard) Manager + Super Admin | Done |
| Admin Dashboard: Overall Hours, Work Hours Summary, Resource Allocation, Pending Approvers, Financial Summary | Done |
| Team Timesheet department filter (?team=) | Done |
| Department filter preserved across period buttons, View, Back | Done |
| Manage Users: team filter form fix (no duplicate input; preserve search/sort) | Done |
| Product create/edit, Webhooks, PDF/Excel export | TODO |
| Time Sheet Grid: removed from UI (sidebar, view, index); route still available | Done |
| Smarty: ucfirst → capitalize fix in sheet.tpl | Done |
| Timesheet date selection: form_action (site_url) for correct form submission | Done |
| Grid empty state: "No time entries for this period" when period has no entries | Done |
| Monthly period link: preserves month_value when switching | Done |
| Cloud security: HTTPS, secure cookies, rate limiting, input validation, XSS/SQLi prevention, security headers | Done |
| Session idle: 24 hours before logout; configurable (config); activity refreshes session | Done |
| Browser URL: display only domain; hide internal routes (History API replaceState or equivalent) | TODO |
| Super Admin: define user cost (salary) per user; store in resource_costs | Done |
| Manager: per-day cost spent per employee (monthly_cost / days_in_month; Jan=31, Apr=30) | Done |
| Voluntary security disclosure: document encryption, access controls, audit, vulnerability reporting | Done |
| Email configuration: SMTP configurable for reminder emails | TODO |
| Employee timesheet reminder: Mon–Fri fewer than 8h per work day or month end (last day) | TODO |
| Approver reminder: consolidated; weekly or monthly to approve pending timesheets | TODO |
| Email templates: Super Admin configures subject and content; placeholders | TODO |
| CLI remind:timesheet + cron for automatic weekly/monthly | TODO |

---

## Checklist Summary

| Section | Items | Purpose |
|---------|-------|---------|
| 1. Constitution Compliance | 8 | Principles I–VIII, BR-1 to BR-5 |
| 2. Requirements Completeness | 11 | Roles, GitHub, D+N, rework, edge cases |
| 3. Phase 0 Readiness | 7 | PHP, extensions, migrations, auth |
| 4. Phase 1–6 Prerequisites | 7 | Products, tasks, time_entries, approvals, export |
| 5. Security & RBAC | 7 | Role checks, Manager/Lead/Employee/Finance blocks |
| 6. Data Integrity | 4 | Locked entries, branch link, sync failure, rejection |
| 7. Testing | 3 | Critical paths, rollback, traceability |
| 8. User Story Acceptance | 5 | US1–US5 |
| 9. Success Criteria | 6 | SC-001 to SC-006 |
| 10. Phase 11–12 Prerequisites | 10 | Session, URL, cost, security, email reminders |

---

**Version**: 1.9.1 | **Created**: 2026-02-19 | **Updated**: 2026-02-20 (Phase 11 progress; costing in Manage Users)
